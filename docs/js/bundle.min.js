"use strict";function mealClass(e,n){function r(){var t=this;t.id=e.createUUID(),t.name="",t.duration=0,t.steps=[]}return r.prototype.convertStepsToDuration=function(){var t=this.steps.sort(function(t,e){return t.duration<e.duration});0<t.length?this.duration=t[0].duration:this.duration=0},r.prototype.formattedDuration=function(){return e.formatDuration(this.duration)},r.prototype.stepCount=function(){return this.steps.length},r.prototype.hasSteps=function(){return 0<this.steps.length},r.build=function(t){var e=new r;return t&&(e.id=t.id,e.name=t.name,e.steps=t.steps?t.steps.map(n.build):[],e.convertStepsToDuration()),e},r}function stepClass(t){function n(){this.id="",this.name="",this.duration=0,this.hours=0,this.minutes=0,this.seconds=0}return n.prototype.parseDuration=function(){this.duration+=60*this.hours*60*1e3,this.duration+=60*this.minutes*1e3,this.duration+=1e3*this.seconds},n.prototype.formattedDuration=function(){return t.formatDuration(this.duration)},n.build=function(t){var e=new n;return t&&(e.id=t.id,e.name=t.name,e.hours=t.hours,e.minutes=t.minutes,e.seconds=t.seconds,e.parseDuration()),e},n}function mealService(t,r,o,i){function a(){var t=angular.fromJson(o.localStorage.meals);return t||[]}return{get:a,getById:function(t){var e=a().map(i.build),n=r("filter")(e,{id:t});return 1!==n.length?i.build():i.build(n[0])},post:function(t){var e=angular.fromJson(o.localStorage.meals);e||(e=[]);var n=e.map(function(t){return t.id}).indexOf(t.id);-1<n?e[n]=t:e.push(t),o.localStorage.meals=angular.toJson(e)}}}var thymerApp=angular.module("thymerApp",["ngRoute"]);function util(){return{createUUID:function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==t?e:3&e|8).toString(16)})},formatDuration:function(t){return Math.floor(t%864e5/36e5)+"h "+Math.floor(t%36e5/6e4)+"m "+Math.floor(t%6e4/1e3)+"s"}}}angular.module("thymerApp").factory("util",util),angular.module("thymerApp").factory("stepClass",stepClass),angular.module("thymerApp").factory("mealClass",["util","stepClass",mealClass]),angular.module("thymerApp").factory("mealService",["$http","$filter","$window","mealClass",mealService]),thymerApp.config(["$routeProvider",function(t){t.when("/",{templateUrl:"../templates/_Home.html",controller:"homeController"}).when("/New",{templateUrl:"../templates/_Edit.html",controller:"editController"}).when("/Edit/:id",{templateUrl:"../templates/_Edit.html",controller:"editController"}).when("/Run/:id",{templateUrl:"../templates/_Run.html",controller:"runController"}).otherwise({redirectTo:"/"})}]),angular.module("thymerApp").controller("editController",["$scope","$routeParams","$location","$filter","mealService","mealClass","stepClass",function(e,t,n,r,o,i,a){e.id=t.id,e.meal=i.build(),e.addStep=function(){e.meal.steps.push(a.build())},e.removeStep=function(t){e.meal.steps.splice(t,1)},e.saveMeal=function(){e.meal.convertStepsToDuration(),o.post(e.meal),n.path("/")},e.goBack=function(){n.path("/")},e.id&&(e.meal=o.getById(e.id))}]),angular.module("thymerApp").controller("homeController",["$scope","$location","$filter","mealService","mealClass",function(t,e,n,r,o){t.meals=[],t.goAdd=function(){e.path("/New")},t.goEdit=function(t){e.path("/Edit/"+t)},t.goRun=function(t){e.path("/Run/"+t)},t.meals=r.get().map(o.build)}]),angular.module("thymerApp").controller("runController",["$scope","$routeParams","$location","$filter","util","mealService","mealClass",function(t,e,n,r,o,i,a){function u(){t.meal=i.getById(t.id),t.currentTimer=t.meal.duration}t.id=e.id,t.meal=a.build(),t.nextStepIndex=0,t.currentTimer=0,t.nextStepTimer=0,t.running=!1,t.paused=!1,t.complete=!1,t.timerId=0,t.goHome=function(){n.path("")},t.goEdit=function(){n.path("/Edit/"+t.meal.id)},t.doRun=function(){t.paused||t.nextStepIndex++,t.nextStepIndex<t.meal.steps.length?t.nextStepTimer=t.currentTimer-t.meal.steps[t.nextStepIndex].duration:t.nextStepTimer=0,t.running=!0,t.timerId=setInterval(function(){if(!t.paused){if(t.currentTimer<=0)return t.running=!1,t.complete=!0,t.currentTimer=0,clearInterval(t.timerId),void t.$apply();t.currentTimer-=1e3,t.nextStepTimer-=1e3,t.$apply()}},1e3)},t.doStop=function(){clearInterval(t.timerId),t.nextStepIndex=0,t.running=!1,t.paused=!1,u()},t.doPause=function(){t.paused=!0,t.running=!1},t.doResume=function(){t.paused=!1,t.running=!0},t.currentTimeLeft=function(){return o.formatDuration(t.currentTimer)},t.timeUntilNextStep=function(){return o.formatDuration(t.nextStepTimer)},t.currentStep=function(){return t.meal.hasSteps()?0===t.nextStepIndex?t.meal.steps[0].name:t.meal.steps[t.nextStepIndex-1].name:""},t.remainingSteps=function(){return t.nextStepIndex+1===t.meal.steps.length?[]:t.meal.steps.slice(t.nextStepIndex+1)},u()}]);