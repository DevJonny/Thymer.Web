"use strict";function mealClass(e,n){function r(){var t=this;t.id=e.createUUID(),t.name="",t.duration=0,t.steps=[]}return r.prototype.convertStepsToDuration=function(){var t=this.steps.sort(function(t,e){return t.duration<e.duration});0<t.length?this.duration=t[0].duration:this.duration=0},r.prototype.formattedDuration=function(){return e.formatDuration(this.duration)},r.prototype.stepCount=function(){return this.steps.length},r.prototype.hasSteps=function(){return 0<this.steps.length},r.build=function(t){var e=new r;return t&&(e.id=t.id,e.name=t.name,e.steps=t.steps?t.steps.map(n.build):[],e.convertStepsToDuration()),e},r}function stepClass(t){function n(){this.id="",this.name="",this.duration=0,this.hours=0,this.minutes=0,this.seconds=0}return n.prototype.parseDuration=function(){this.duration+=60*this.hours*60*1e3,this.duration+=60*this.minutes*1e3,this.duration+=1e3*this.seconds},n.prototype.formattedDuration=function(){return t.formatDuration(this.duration)},n.build=function(t){var e=new n;return t&&(e.id=t.id,e.name=t.name,e.hours=t.hours,e.minutes=t.minutes,e.seconds=t.seconds,e.parseDuration()),e},n}function mealService(t,r,i,o){function a(){var t=angular.fromJson(i.localStorage.meals);return t||[]}return{get:a,getById:function(t){var e=a().map(o.build),n=r("filter")(e,{id:t});return 1!==n.length?o.build():o.build(n[0])},post:function(t){var e=angular.fromJson(i.localStorage.meals);e||(e=[]);var n=e.map(function(t){return t.id}).indexOf(t.id);-1<n?e[n]=t:e.push(t),i.localStorage.meals=angular.toJson(e)}}}var thymerApp=angular.module("thymerApp",["ngRoute"]);function util(){return{createUUID:function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==t?e:3&e|8).toString(16)})},formatDuration:function(t){return Math.floor(t%864e5/36e5)+"h "+Math.floor(t%36e5/6e4)+"m "+Math.floor(t%6e4/1e3)+"s"}}}angular.module("thymerApp").factory("util",util),angular.module("thymerApp").factory("stepClass",stepClass),angular.module("thymerApp").factory("mealClass",["util","stepClass",mealClass]),angular.module("thymerApp").factory("mealService",["$http","$filter","$window","mealClass","stepClass",mealService]),thymerApp.config(["$routeProvider",function(t){t.when("/",{templateUrl:"/Thymer.Web/templates/Home.html",controller:"homeController"}).when("/New",{templateUrl:"/Thymer.Web/templates/Edit.html",controller:"editController"}).when("/Edit/:id",{templateUrl:"/Thymer.Web/templates/Edit.html",controller:"editController"}).when("/Run/:id",{templateUrl:"/Thymer.Web/templates/Run.html",controller:"runController"}).otherwise({redirectTo:"/"})}]),angular.module("thymerApp").controller("editController",["$scope","$routeParams","$location","$filter","mealService","mealClass","stepClass",function(e, t, n, r, i, o, a){e.id=t.id,e.meal=o.build(),e.addStep=function(){e.meal.steps.push(a.build())},e.removeStep=function(t){e.meal.steps.splice(t,1)},e.saveMeal=function(){e.meal.convertStepsToDuration(),i.post(e.meal),n.path("/")},e.goBack=function(){n.path("/")},e.id&&(e.meal=i.getById(e.id))}]),angular.module("thymerApp").controller("homeController",["$scope","$location","$filter","mealService","mealClass",function(t,e,n,r,i){t.meals=[],t.goAdd=function(){e.path("/New")},t.goEdit=function(t){e.path("/Edit/"+t)},t.goRun=function(t){e.path("/Run/"+t)},t.meals=r.get().map(i.build)}]),angular.module("thymerApp").controller("runController",["$scope","$routeParams","$location","$filter","util","mealService","mealClass","stepClass",function(e,t,n,r,i,o,a,u){function s(){e.meal=o.getById(e.id),e.currentTimer=e.meal.duration,e.nextStep=e.meal.steps.shift()}e.id=t.id,e.meal=a.build(),e.currentStep,e.nextStep,e.currentTimer=0,e.nextStepTimer=0,e.pastSteps=[],e.running=!1,e.paused=!1,e.complete=!1,e.timerId=0,e.reset=function(){e.complete=!1,e.currentTimer=0,e.nextStepTimer=0,e.currentTimer=0,e.nextStepTimer=0,e.pastSteps=[],e.timerId=0},e.goHome=function(){n.path("")},e.goEdit=function(){n.path("/Edit/"+e.meal.id)},e.doRun=function(){e.complete&&(e.reset(),s()),e.currentStep=e.nextStep,e.nextStep=0<e.meal.steps.length?e.meal.steps.shift():u.build(),e.hasRemainingSteps()?e.nextStepTimer=e.currentTimer-e.nextStep.duration:e.nextStepTimer=0,e.running=!0,e.timerId=setInterval(function(){if(!e.paused){e.currentTimer-=1e3,e.nextStepTimer=e.nextStep?e.nextStepTimer-1e3:1;var t=e.nextStepTimer<=0;if(t&&(new Audio("/Thymer.Web/assets/step_finished.mp3").play(),e.pastSteps.push(e.currentStep),e.currentStep=e.nextStep,e.hasRemainingSteps()?(e.nextStep=e.meal.steps.shift(),e.nextStepTimer=e.nextStep.duration):(e.nextStep=null,e.nextStepTimer=0)),e.currentTimer<=0)return new Audio("/Thymer.Web/assets/meal_finished.mp3").play(),e.pastSteps.push(e.currentStep),e.running=!1,e.complete=!0,e.currentTimer=0,clearInterval(e.timerId),void e.$apply();e.$apply()}},1e3)},e.doStop=function(){clearInterval(e.timerId),e.running=!1,e.paused=!1,s()},e.doPause=function(){e.paused=!0,e.running=!1},e.doResume=function(){e.paused=!1,e.running=!0},e.currentTimeLeft=function(){return i.formatDuration(e.currentTimer)},e.timeUntilNextStep=function(){return i.formatDuration(e.nextStepTimer)},e.remainingSteps=function(){return e.nextStepIndex+1===e.meal.steps.length?[]:e.meal.steps.slice(e.nextStepIndex+1)},e.hasRemainingSteps=function(){return 0<e.meal.stepCount()},e.reset(),s()}]);